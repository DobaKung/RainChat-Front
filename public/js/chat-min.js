function scrollToBottom(){$("#chatlog").scrollTop($("#chatlog")[0].scrollHeight)}function connect(e,o){var n=new WebSocket("ws://"+e+":"+o);return console.log(n),n}function addChatLog(e,o,n){if(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),null===o)$("#chatlog").append('<div class="b bubble me">'+n+"</div>"),scrollToBottom();else{var s='<div class="bubble other">'+n+"</div>";if(e===last_id)var t="";else var t='<div class="other-name">'+o+"</div>";$("#chatlog").append('<div class="b bub-other-group">'+t+s+"</div>"),$(".b:last-child").visible()&&scrollToBottom(),document.hasFocus()||notiSound.play()}return"/rain"===n&&(createRain(),console.log("Raining")),console.log("Message received: "+n),e}function sendMessage(e){message=$("#chat").val(),message&&("/exit"===message&&location.reload(),$("#chat").val(""),e.send(message),message=message.replace(/</g,"&lt;").replace(/>/g,"&gt;"),addChatLog(-1,null,message))}function ready(e,o,n){$("#chatform").submit(function(o){o.preventDefault(),sendMessage(e),last_id=-1}),app.loggedIn=!0,app.typeHere="Type and press enter to send",$("input#chat").focus()}function listen(e,o,n,s){console.log(s);var t=JSON.parse(s);if("message"===t.type)last_id=addChatLog(t.id,t.username,t.message);else if("online"===t.type)console.log(t),"added"in t&&t.added,app.online=t.users;else if("login"===t.type){if(t.iserror)throw app.loginErrMsg=t.errormsg,t.errormsg;console.log("Logged in!"),ready(e,o,n)}else"rooms"===t.type?console.log(t):console.log("invalid server response")}function login(e,o,n){var s={username:o};console.log(JSON.stringify(s)),e.send(JSON.stringify(s))}var last_id=-1,notiSound=new Audio("noti.mp3"),config,app=new Vue({el:"#app",data:{ws:null,login_count:0,loggedIn:!1,loginErrMsg:"",username:"",room:"",drawerOpen:!1,menuOpen:!1,inputBox:"Please log in first",night:!1,nightText:"Night mode",online:[],config:null},methods:{onlineList:function(){var e='{ "type": "online", "count": 0, "users": []}',o=JSON.parse('{ "type": "online", "count": 0, "users": []}');this.online=o.users},checkLogin:function(){if(this.username){if(this.username)if(1===++this.login_count)this.ws=connect(config.host,config.port),this.ws.onopen=function(){login(app.ws,app.username,"global")},this.ws.onmessage=function(e){listen(app.ws,app.username,app.roomname,e.data)},this.inputBox="Type here";else try{login(this.ws,this.username,"global")}catch(e){console.log(e)}}else this.loginErrMsg="Please enter a display name"},toggleNight:function(){$("body").toggleClass("night"),this.night=!this.night,!1===this.night?(this.nightText="Night mode",$('meta[name="theme-color"]').attr("content","#00b8ff")):(this.nightText="Normal",$('meta[name="theme-color"]').attr("content","#000"))}}});$.getJSON("config.json",function(e){config=e,app.config=config,console.log(config)});